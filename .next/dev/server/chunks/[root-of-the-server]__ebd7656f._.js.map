{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\"\nimport { MongoClient } from \"mongodb\"\nimport { mongodbAdapter } from \"better-auth/adapters/mongodb\"\nimport { nextCookies } from \"better-auth/next-js\"\n\n// MongoDB connection\nconst connectionString = process.env.DATABASE_URL || \"mongodb://localhost:27017/trackify-ventures\"\n\n// Extract database name from connection string\nfunction getDatabaseName(connectionString: string): string {\n  try {\n    const url = new URL(connectionString.replace(/^mongodb\\+srv:/, \"mongodb:\"))\n    const pathname = url.pathname\n    // Remove leading slash and get database name\n    const dbName = pathname.split(\"/\")[1]?.split(\"?\")[0] || \"trackify-ventures\"\n    return dbName\n  } catch {\n    // Fallback: try to extract from connection string manually\n    const match = connectionString.match(/\\/([^/?]+)(\\?|$)/)\n    return match ? match[1] : \"trackify-ventures\"\n  }\n}\n\nconst databaseName = getDatabaseName(connectionString)\n\n// Create MongoDB client with proper connection options for Atlas\n// Note: mongodb+srv:// automatically uses TLS, so we don't need to set it explicitly\nconst client = new MongoClient(connectionString, {\n  maxPoolSize: 10,\n  minPoolSize: 2,\n  maxIdleTimeMS: 30000,\n  serverSelectionTimeoutMS: 10000,\n  socketTimeoutMS: 45000,\n  connectTimeoutMS: 10000,\n  retryWrites: true,\n  retryReads: true,\n})\n\n// Global client instance to reuse across requests (Next.js pattern)\nconst globalForMongo = globalThis as unknown as {\n  _mongoClient?: MongoClient\n  _mongoClientPromise?: Promise<MongoClient>\n}\n\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === \"development\") {\n  // In development, use a global variable so the client is not recreated on hot reloads\n  if (!globalForMongo._mongoClientPromise) {\n    globalForMongo._mongoClientPromise = client.connect().catch((error) => {\n      console.error(\"Failed to connect to MongoDB:\", error)\n      // Don't throw here, let Better Auth handle it\n      return client\n    })\n  }\n  clientPromise = globalForMongo._mongoClientPromise\n} else {\n  // In production, create connection promise\n  clientPromise = client.connect().catch((error) => {\n    console.error(\"Failed to connect to MongoDB:\", error)\n    return client\n  })\n}\n\n// Initialize connection immediately (non-blocking)\nclientPromise.then((connectedClient) => {\n  globalForMongo._mongoClient = connectedClient\n  console.log(\"MongoDB connected successfully\")\n}).catch((error) => {\n  console.error(\"MongoDB connection error:\", error)\n})\n\n// Get database instance - Better Auth will handle connection when needed\nconst db = client.db(databaseName)\n\nexport const auth = betterAuth({\n  database: mongodbAdapter(db, {\n    client,\n  }),\n  emailAndPassword: {\n    enabled: true,\n    requireEmailVerification: false, // Set to true if you want email verification\n    sendResetPassword: async ({ user, url, token }, request) => {\n      // TODO: Integrate with your email service (Resend, SendGrid, etc.)\n      // For now, we'll log the reset link. In production, send an email.\n      console.log(\"Password reset requested for:\", user.email)\n      console.log(\"Reset URL:\", url)\n      console.log(\"Reset token:\", token)\n      \n      // Example with a real email service:\n      // await sendEmail({\n      //   to: user.email,\n      //   subject: \"Reset your password\",\n      //   html: `\n      //     <h2>Reset Your Password</h2>\n      //     <p>Click the link below to reset your password:</p>\n      //     <a href=\"${url}\">Reset Password</a>\n      //     <p>This link will expire in 1 hour.</p>\n      //   `,\n      // })\n    },\n    onPasswordReset: async ({ user }, request) => {\n      console.log(`Password reset successful for user: ${user.email}`)\n    },\n  },\n  user: {\n    additionalFields: {\n      role: {\n        type: \"string\",\n        required: false,\n        defaultValue: null,\n        input: false, // Don't allow user to set role during signup\n      },\n      onboardingCompleted: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false,\n        input: false,\n      },\n    },\n  },\n  plugins: [nextCookies()],\n})\n\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AAAA;AACA;;;;;AAEA,qBAAqB;AACrB,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAErD,+CAA+C;AAC/C,SAAS,gBAAgB,gBAAwB;IAC/C,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,iBAAiB,OAAO,CAAC,kBAAkB;QAC/D,MAAM,WAAW,IAAI,QAAQ;QAC7B,6CAA6C;QAC7C,MAAM,SAAS,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;QACxD,OAAO;IACT,EAAE,OAAM;QACN,2DAA2D;QAC3D,MAAM,QAAQ,iBAAiB,KAAK,CAAC;QACrC,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;IAC5B;AACF;AAEA,MAAM,eAAe,gBAAgB;AAErC,iEAAiE;AACjE,qFAAqF;AACrF,MAAM,SAAS,IAAI,sHAAW,CAAC,kBAAkB;IAC/C,aAAa;IACb,aAAa;IACb,eAAe;IACf,0BAA0B;IAC1B,iBAAiB;IACjB,kBAAkB;IAClB,aAAa;IACb,YAAY;AACd;AAEA,oEAAoE;AACpE,MAAM,iBAAiB;AAKvB,IAAI;AAEJ,wCAA4C;IAC1C,sFAAsF;IACtF,IAAI,CAAC,eAAe,mBAAmB,EAAE;QACvC,eAAe,mBAAmB,GAAG,OAAO,OAAO,GAAG,KAAK,CAAC,CAAC;YAC3D,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,8CAA8C;YAC9C,OAAO;QACT;IACF;IACA,gBAAgB,eAAe,mBAAmB;AACpD;;AAQA,mDAAmD;AACnD,cAAc,IAAI,CAAC,CAAC;IAClB,eAAe,YAAY,GAAG;IAC9B,QAAQ,GAAG,CAAC;AACd,GAAG,KAAK,CAAC,CAAC;IACR,QAAQ,KAAK,CAAC,6BAA6B;AAC7C;AAEA,yEAAyE;AACzE,MAAM,KAAK,OAAO,EAAE,CAAC;AAEd,MAAM,OAAO,IAAA,4XAAU,EAAC;IAC7B,UAAU,IAAA,waAAc,EAAC,IAAI;QAC3B;IACF;IACA,kBAAkB;QAChB,SAAS;QACT,0BAA0B;QAC1B,mBAAmB,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE;YAC9C,mEAAmE;YACnE,mEAAmE;YACnE,QAAQ,GAAG,CAAC,iCAAiC,KAAK,KAAK;YACvD,QAAQ,GAAG,CAAC,cAAc;YAC1B,QAAQ,GAAG,CAAC,gBAAgB;QAE5B,qCAAqC;QACrC,oBAAoB;QACpB,oBAAoB;QACpB,oCAAoC;QACpC,YAAY;QACZ,mCAAmC;QACnC,0DAA0D;QAC1D,0CAA0C;QAC1C,8CAA8C;QAC9C,OAAO;QACP,KAAK;QACP;QACA,iBAAiB,OAAO,EAAE,IAAI,EAAE,EAAE;YAChC,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,KAAK,KAAK,EAAE;QACjE;IACF;IACA,MAAM;QACJ,kBAAkB;YAChB,MAAM;gBACJ,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;YACA,qBAAqB;gBACnB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;QACF;IACF;IACA,SAAS;QAAC,IAAA,2YAAW;KAAG;AAC1B"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/lib/db.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\"\n\nconst connectionString = process.env.DATABASE_URL || \"mongodb://localhost:27017/trackify-ventures\"\n\n// Extract database name from connection string\nfunction getDatabaseName(connectionString: string): string {\n  try {\n    const url = new URL(connectionString.replace(/^mongodb\\+srv:/, \"mongodb:\"))\n    const pathname = url.pathname\n    // Remove leading slash and get database name\n    const dbName = pathname.split(\"/\")[1]?.split(\"?\")[0] || \"trackify-ventures\"\n    return dbName\n  } catch {\n    // Fallback: try to extract from connection string manually\n    const match = connectionString.match(/\\/([^/?]+)(\\?|$)/)\n    return match ? match[1] : \"trackify-ventures\"\n  }\n}\n\nconst databaseName = getDatabaseName(connectionString)\n\n// Create MongoDB client with proper connection options for Atlas\nconst client = new MongoClient(connectionString, {\n  maxPoolSize: 10,\n  minPoolSize: 2,\n  maxIdleTimeMS: 30000,\n  serverSelectionTimeoutMS: 10000,\n  socketTimeoutMS: 45000,\n  connectTimeoutMS: 10000,\n  retryWrites: true,\n  retryReads: true,\n})\n\n// Global client instance to reuse across requests (Next.js pattern)\nconst globalForMongo = globalThis as unknown as {\n  _mongoClient?: MongoClient\n  _mongoClientPromise?: Promise<MongoClient>\n}\n\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === \"development\") {\n  // In development, use a global variable so the client is not recreated on hot reloads\n  if (!globalForMongo._mongoClientPromise) {\n    globalForMongo._mongoClientPromise = client.connect().catch((error) => {\n      console.error(\"Failed to connect to MongoDB:\", error)\n      return client\n    })\n  }\n  clientPromise = globalForMongo._mongoClientPromise\n} else {\n  // In production, create connection promise\n  clientPromise = client.connect().catch((error) => {\n    console.error(\"Failed to connect to MongoDB:\", error)\n    return client\n  })\n}\n\n// Initialize connection immediately (non-blocking)\nclientPromise\n  .then((connectedClient) => {\n    globalForMongo._mongoClient = connectedClient\n    console.log(\"MongoDB connected successfully (db.ts)\")\n  })\n  .catch((error) => {\n    console.error(\"MongoDB connection error (db.ts):\", error)\n  })\n\nexport async function getDatabase(): Promise<Db> {\n  try {\n    // Ensure client is connected\n    const connectedClient = await clientPromise\n    // Check if client is still connected, reconnect if needed\n    if (!connectedClient.topology?.isConnected()) {\n      console.warn(\"MongoDB client disconnected, reconnecting...\")\n      await connectedClient.connect()\n    }\n    return connectedClient.db(databaseName)\n  } catch (error) {\n    console.error(\"Error getting database connection:\", error)\n    // Try to reconnect\n    try {\n      await client.close()\n      const newClient = new MongoClient(connectionString, {\n        maxPoolSize: 10,\n        minPoolSize: 2,\n        maxIdleTimeMS: 30000,\n        serverSelectionTimeoutMS: 10000,\n        socketTimeoutMS: 45000,\n        connectTimeoutMS: 10000,\n        retryWrites: true,\n        retryReads: true,\n      })\n      clientPromise = newClient.connect()\n      const connectedClient = await clientPromise\n      return connectedClient.db(databaseName)\n    } catch (reconnectError) {\n      console.error(\"Failed to reconnect to MongoDB:\", reconnectError)\n      throw reconnectError\n    }\n  }\n}\n\n// For cleanup if needed\nexport async function closeDatabase() {\n  try {\n    const connectedClient = await clientPromise\n    await connectedClient.close()\n  } catch (error) {\n    console.error(\"Error closing database connection:\", error)\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAErD,+CAA+C;AAC/C,SAAS,gBAAgB,gBAAwB;IAC/C,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,iBAAiB,OAAO,CAAC,kBAAkB;QAC/D,MAAM,WAAW,IAAI,QAAQ;QAC7B,6CAA6C;QAC7C,MAAM,SAAS,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;QACxD,OAAO;IACT,EAAE,OAAM;QACN,2DAA2D;QAC3D,MAAM,QAAQ,iBAAiB,KAAK,CAAC;QACrC,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;IAC5B;AACF;AAEA,MAAM,eAAe,gBAAgB;AAErC,iEAAiE;AACjE,MAAM,SAAS,IAAI,sHAAW,CAAC,kBAAkB;IAC/C,aAAa;IACb,aAAa;IACb,eAAe;IACf,0BAA0B;IAC1B,iBAAiB;IACjB,kBAAkB;IAClB,aAAa;IACb,YAAY;AACd;AAEA,oEAAoE;AACpE,MAAM,iBAAiB;AAKvB,IAAI;AAEJ,wCAA4C;IAC1C,sFAAsF;IACtF,IAAI,CAAC,eAAe,mBAAmB,EAAE;QACvC,eAAe,mBAAmB,GAAG,OAAO,OAAO,GAAG,KAAK,CAAC,CAAC;YAC3D,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO;QACT;IACF;IACA,gBAAgB,eAAe,mBAAmB;AACpD;;AAQA,mDAAmD;AACnD,cACG,IAAI,CAAC,CAAC;IACL,eAAe,YAAY,GAAG;IAC9B,QAAQ,GAAG,CAAC;AACd,GACC,KAAK,CAAC,CAAC;IACN,QAAQ,KAAK,CAAC,qCAAqC;AACrD;AAEK,eAAe;IACpB,IAAI;QACF,6BAA6B;QAC7B,MAAM,kBAAkB,MAAM;QAC9B,0DAA0D;QAC1D,IAAI,CAAC,gBAAgB,QAAQ,EAAE,eAAe;YAC5C,QAAQ,IAAI,CAAC;YACb,MAAM,gBAAgB,OAAO;QAC/B;QACA,OAAO,gBAAgB,EAAE,CAAC;IAC5B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,mBAAmB;QACnB,IAAI;YACF,MAAM,OAAO,KAAK;YAClB,MAAM,YAAY,IAAI,sHAAW,CAAC,kBAAkB;gBAClD,aAAa;gBACb,aAAa;gBACb,eAAe;gBACf,0BAA0B;gBAC1B,iBAAiB;gBACjB,kBAAkB;gBAClB,aAAa;gBACb,YAAY;YACd;YACA,gBAAgB,UAAU,OAAO;YACjC,MAAM,kBAAkB,MAAM;YAC9B,OAAO,gBAAgB,EAAE,CAAC;QAC5B,EAAE,OAAO,gBAAgB;YACvB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,MAAM;QACR;IACF;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,kBAAkB,MAAM;QAC9B,MAAM,gBAAgB,KAAK;IAC7B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;IACtD;AACF"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/lib/auth-helpers.ts"],"sourcesContent":["import { auth } from \"@/lib/auth\"\nimport { headers } from \"next/headers\"\nimport { getDatabase } from \"@/lib/db\"\n\nexport async function getSessionWithRole() {\n  try {\n    const session = await auth.api.getSession({\n      headers: await headers(),\n    })\n\n    if (!session) {\n      return null\n    }\n\n    // Get user with role from database\n    const db = await getDatabase()\n    \n    // Log database info for debugging\n    const dbName = db.databaseName\n    console.log(\"Querying database:\", dbName, \"for user ID:\", session.user.id, \"Email:\", session.user.email)\n    \n    // Better Auth with MongoDB uses _id as primary key, not id\n    // The session.user.id is the string representation of _id\n    let user = null\n    let queryMethod = \"unknown\"\n    \n    // Try _id first (MongoDB's primary key) - this is what Better Auth uses\n    try {\n      const { ObjectId } = await import(\"mongodb\")\n      if (ObjectId.isValid(session.user.id)) {\n        user = await db.collection(\"user\").findOne({ _id: new ObjectId(session.user.id) })\n        if (user) {\n          queryMethod = \"_id\"\n          console.log(\"Found user by _id!\")\n        }\n      }\n    } catch (e) {\n      console.log(\"ObjectId query failed:\", e)\n    }\n    \n    // If not found by _id, try by email as fallback\n    if (!user && session.user.email) {\n      console.log(\"User not found by _id, trying email:\", session.user.email)\n      user = await db.collection(\"user\").findOne({ email: session.user.email })\n      if (user) {\n        queryMethod = \"email\"\n        console.log(\"Found user by email!\")\n      } else {\n        console.log(\"User not found by email either\")\n      }\n    }\n    \n    // Last resort: try id field (though Better Auth doesn't use this)\n    if (!user) {\n      user = await db.collection(\"user\").findOne({ id: session.user.id })\n      if (user) {\n        queryMethod = \"id\"\n        console.log(\"Found user by id field\")\n      }\n    }\n    \n    // List all users for debugging (remove in production)\n    if (!user) {\n      const allUsers = await db.collection(\"user\").find({}).limit(5).toArray()\n      console.log(\"Sample users in database:\", allUsers.map(u => ({ \n        id: u.id, \n        _id: u._id?.toString(), \n        email: u.email,\n        role: u.role,\n        onboardingCompleted: u.onboardingCompleted\n      })))\n    }\n\n    if (!user) {\n      console.warn(\"User not found in database for session:\", {\n        userId: session.user.id,\n        email: session.user.email,\n        database: dbName\n      })\n      // Return session without role if user not found in database yet\n      // This can happen during signup before user is fully created\n      return {\n        ...session,\n        user: {\n          ...session.user,\n          role: null,\n          onboardingCompleted: false,\n        },\n      }\n    }\n    \n    console.log(\"User found via\", queryMethod, \":\", {\n      id: user.id,\n      _id: user._id?.toString(),\n      email: user.email,\n      role: user.role,\n      onboardingCompleted: user.onboardingCompleted\n    })\n\n    const result = {\n      ...session,\n      user: {\n        ...session.user,\n        role: user.role || null,\n        onboardingCompleted: user.onboardingCompleted || false,\n      },\n    }\n    \n    console.log(\"Returning session with role:\", {\n      userId: result.user.id,\n      email: result.user.email,\n      role: result.user.role,\n      onboardingCompleted: result.user.onboardingCompleted\n    })\n    \n    return result\n  } catch (error) {\n    console.error(\"Error in getSessionWithRole:\", error)\n    // Return null on error to trigger redirect to sign-in\n    return null\n  }\n}\n\nexport async function requireAuth() {\n  const session = await getSessionWithRole()\n  if (!session) {\n    throw new Error(\"Unauthorized\")\n  }\n  return session\n}\n\nexport async function requireOnboarding() {\n  const session = await requireAuth()\n  if (!session.user.onboardingCompleted) {\n    throw new Error(\"Onboarding not completed\")\n  }\n  return session\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/app/api/founder/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { getSessionWithRole } from \"@/lib/auth-helpers\"\nimport { getDatabase } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getSessionWithRole()\n\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const db = await getDatabase()\n    const userId = session.user.id\n\n    // Get active fundraise for this founder\n    const activeFundraise = await db\n      .collection(\"fundraises\")\n      .findOne({\n        userId,\n        status: \"active\",\n      })\n\n    // Get all fundraises for this founder\n    const allFundraises = await db\n      .collection(\"fundraises\")\n      .find({ userId })\n      .sort({ createdAt: -1 })\n      .toArray()\n\n    // Get investor interests\n    const investorInterests = await db\n      .collection(\"investor_interests\")\n      .find({ userId })\n      .sort({ createdAt: -1 })\n      .limit(5)\n      .toArray()\n\n    // Get company metrics (revenue, expenses, cash flow)\n    const companyMetrics = await db\n      .collection(\"company_metrics\")\n      .find({ userId })\n      .sort({ month: -1 })\n      .limit(6)\n      .toArray()\n\n    // Calculate KPIs from metrics\n    const latestMetric = companyMetrics[0] || null\n    const previousMetric = companyMetrics[1] || null\n\n    const monthlyRevenue = latestMetric?.revenue || 0\n    const monthlyExpenses = latestMetric?.expenses || 0\n    const burnRate = monthlyExpenses\n    const cashOnHand = latestMetric?.cash || 0\n    const runway = burnRate > 0 ? Math.floor(cashOnHand / burnRate) : 0\n\n    // Calculate revenue growth\n    const revenueGrowth = previousMetric && previousMetric.revenue > 0\n      ? (((monthlyRevenue - previousMetric.revenue) / previousMetric.revenue) * 100).toFixed(0)\n      : \"0\"\n\n    // Calculate burn rate change\n    const burnRateChange = previousMetric && previousMetric.expenses > 0\n      ? (((burnRate - previousMetric.expenses) / previousMetric.expenses) * 100).toFixed(0)\n      : \"0\"\n\n    // Get active investors count\n    const activeInvestors = await db\n      .collection(\"investor_interests\")\n      .countDocuments({\n        userId,\n        status: { $in: [\"interested\", \"reviewing\", \"due_diligence\"] },\n      })\n\n    // Get new investors this month\n    const thisMonth = new Date()\n    thisMonth.setDate(1)\n    const newInvestorsThisMonth = await db\n      .collection(\"investor_interests\")\n      .countDocuments({\n        userId,\n        createdAt: { $gte: thisMonth },\n      })\n\n    // Prepare revenue and expenses data for chart (last 6 months)\n    const revenueData = companyMetrics\n      .slice()\n      .reverse()\n      .map((metric) => ({\n        month: metric.month || \"Unknown\",\n        revenue: metric.revenue || 0,\n        expenses: metric.expenses || 0,\n      }))\n\n    // Fill in missing months if needed\n    const monthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n    const now = new Date()\n    const filledRevenueData = []\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(now.getFullYear(), now.getMonth() - i, 1)\n      const monthName = monthNames[date.getMonth()]\n      const existing = revenueData.find((d) => d.month === monthName)\n      filledRevenueData.push(\n        existing || {\n          month: monthName,\n          revenue: 0,\n          expenses: 0,\n        }\n      )\n    }\n\n    // Prepare cash flow data\n    const cashFlowData = companyMetrics\n      .slice()\n      .reverse()\n      .map((metric) => ({\n        month: metric.month || \"Unknown\",\n        cash: metric.cash || 0,\n      }))\n\n    // Fill in missing months for cash flow\n    const filledCashFlowData = []\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(now.getFullYear(), now.getMonth() - i, 1)\n      const monthName = monthNames[date.getMonth()]\n      const existing = cashFlowData.find((d) => d.month === monthName)\n      filledCashFlowData.push(\n        existing || {\n          month: monthName,\n          cash: 0,\n        }\n      )\n    }\n\n    // Transform investor interests\n    const transformedInvestorInterests = investorInterests.map((interest) => {\n      const createdAt = interest.createdAt ? new Date(interest.createdAt) : new Date()\n      const now = new Date()\n      const daysAgo = Math.floor((now.getTime() - createdAt.getTime()) / (1000 * 60 * 60 * 24))\n\n      let dateText = \"\"\n      if (daysAgo === 0) {\n        dateText = \"Today\"\n      } else if (daysAgo === 1) {\n        dateText = \"1 day ago\"\n      } else if (daysAgo < 7) {\n        dateText = `${daysAgo} days ago`\n      } else {\n        const weeksAgo = Math.floor(daysAgo / 7)\n        dateText = `${weeksAgo} week${weeksAgo > 1 ? \"s\" : \"\"} ago`\n      }\n\n      return {\n        name: interest.investorName || \"Unknown Investor\",\n        status: interest.status || \"Interested\",\n        date: dateText,\n      }\n    })\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        kpis: {\n          monthlyRevenue: {\n            value: `$${(monthlyRevenue / 1000).toFixed(0)}K`,\n            change: `+${revenueGrowth}%`,\n            trend: parseFloat(revenueGrowth) >= 0 ? (\"up\" as const) : (\"down\" as const),\n          },\n          burnRate: {\n            value: `$${(burnRate / 1000).toFixed(0)}K/mo`,\n            change: `+${burnRateChange}%`,\n            trend: \"up\" as const,\n          },\n          runway: {\n            value: `${runway} months`,\n            change: \"Stable\",\n            trend: \"up\" as const,\n          },\n          activeInvestors: {\n            value: activeInvestors.toString(),\n            change: `+${newInvestorsThisMonth}`,\n            trend: \"up\" as const,\n          },\n        },\n        currentFundraise: activeFundraise\n          ? {\n              roundType: activeFundraise.roundType || \"Series A\",\n              target: activeFundraise.targetAmount || 0,\n              committed: activeFundraise.committedAmount || 0,\n              percentage: activeFundraise.targetAmount\n                ? Math.round(((activeFundraise.committedAmount || 0) / activeFundraise.targetAmount) * 100)\n                : 0,\n              status: activeFundraise.status || \"active\",\n            }\n          : null,\n        revenueData: filledRevenueData,\n        cashFlowData: filledCashFlowData,\n        investorInterests: transformedInvestorInterests,\n      },\n    })\n  } catch (error) {\n    console.error(\"Error fetching founder stats:\", error)\n    return NextResponse.json({ error: \"Failed to fetch founder stats\" }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}
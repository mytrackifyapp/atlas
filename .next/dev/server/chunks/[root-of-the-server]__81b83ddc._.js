module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/mongodb [external] (mongodb, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("mongodb", () => require("mongodb"));

module.exports = mod;
}),
"[project]/lib/auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "auth",
    ()=>auth
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/better-auth@1.4.7_@prisma+client@7.1.0_prisma@7.1.0_@types+react@19.2.7_react-dom@19.2._bd7c77fb510da8d9502659b8eb9a6693/node_modules/better-auth/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$auth$2f$auth$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/better-auth@1.4.7_@prisma+client@7.1.0_prisma@7.1.0_@types+react@19.2.7_react-dom@19.2._bd7c77fb510da8d9502659b8eb9a6693/node_modules/better-auth/dist/auth/auth.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongodb [external] (mongodb, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapters$2f$mongodb$2d$adapter$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/better-auth@1.4.7_@prisma+client@7.1.0_prisma@7.1.0_@types+react@19.2.7_react-dom@19.2._bd7c77fb510da8d9502659b8eb9a6693/node_modules/better-auth/dist/adapters/mongodb-adapter/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapters$2f$mongodb$2d$adapter$2f$mongodb$2d$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/better-auth@1.4.7_@prisma+client@7.1.0_prisma@7.1.0_@types+react@19.2.7_react-dom@19.2._bd7c77fb510da8d9502659b8eb9a6693/node_modules/better-auth/dist/adapters/mongodb-adapter/mongodb-adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$integrations$2f$next$2d$js$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/better-auth@1.4.7_@prisma+client@7.1.0_prisma@7.1.0_@types+react@19.2.7_react-dom@19.2._bd7c77fb510da8d9502659b8eb9a6693/node_modules/better-auth/dist/integrations/next-js.mjs [app-route] (ecmascript)");
;
;
;
;
// MongoDB connection
const connectionString = process.env.DATABASE_URL || "mongodb://localhost:27017/trackify-ventures";
// Extract database name from connection string
function getDatabaseName(connectionString) {
    try {
        const url = new URL(connectionString.replace(/^mongodb\+srv:/, "mongodb:"));
        const pathname = url.pathname;
        // Remove leading slash and get database name
        const dbName = pathname.split("/")[1]?.split("?")[0] || "trackify-ventures";
        return dbName;
    } catch  {
        // Fallback: try to extract from connection string manually
        const match = connectionString.match(/\/([^/?]+)(\?|$)/);
        return match ? match[1] : "trackify-ventures";
    }
}
const databaseName = getDatabaseName(connectionString);
// Create MongoDB client with proper connection options for Atlas
// Note: mongodb+srv:// automatically uses TLS, so we don't need to set it explicitly
const client = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__["MongoClient"](connectionString, {
    maxPoolSize: 10,
    minPoolSize: 2,
    maxIdleTimeMS: 30000,
    serverSelectionTimeoutMS: 10000,
    socketTimeoutMS: 45000,
    connectTimeoutMS: 10000,
    retryWrites: true,
    retryReads: true
});
// Global client instance to reuse across requests (Next.js pattern)
const globalForMongo = globalThis;
let clientPromise;
if ("TURBOPACK compile-time truthy", 1) {
    // In development, use a global variable so the client is not recreated on hot reloads
    if (!globalForMongo._mongoClientPromise) {
        globalForMongo._mongoClientPromise = client.connect().catch((error)=>{
            console.error("Failed to connect to MongoDB:", error);
            // Don't throw here, let Better Auth handle it
            return client;
        });
    }
    clientPromise = globalForMongo._mongoClientPromise;
} else //TURBOPACK unreachable
;
// Initialize connection immediately (non-blocking)
clientPromise.then((connectedClient)=>{
    globalForMongo._mongoClient = connectedClient;
    console.log("MongoDB connected successfully");
}).catch((error)=>{
    console.error("MongoDB connection error:", error);
});
// Get database instance - Better Auth will handle connection when needed
const db = client.db(databaseName);
const auth = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$auth$2f$auth$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["betterAuth"])({
    database: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$adapters$2f$mongodb$2d$adapter$2f$mongodb$2d$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mongodbAdapter"])(db, {
        client
    }),
    emailAndPassword: {
        enabled: true,
        requireEmailVerification: false,
        sendResetPassword: async ({ user, url, token }, request)=>{
            // TODO: Integrate with your email service (Resend, SendGrid, etc.)
            // For now, we'll log the reset link. In production, send an email.
            console.log("Password reset requested for:", user.email);
            console.log("Reset URL:", url);
            console.log("Reset token:", token);
        // Example with a real email service:
        // await sendEmail({
        //   to: user.email,
        //   subject: "Reset your password",
        //   html: `
        //     <h2>Reset Your Password</h2>
        //     <p>Click the link below to reset your password:</p>
        //     <a href="${url}">Reset Password</a>
        //     <p>This link will expire in 1 hour.</p>
        //   `,
        // })
        },
        onPasswordReset: async ({ user }, request)=>{
            console.log(`Password reset successful for user: ${user.email}`);
        }
    },
    user: {
        additionalFields: {
            role: {
                type: "string",
                required: false,
                defaultValue: null,
                input: false
            },
            onboardingCompleted: {
                type: "boolean",
                required: false,
                defaultValue: false,
                input: false
            }
        }
    },
    plugins: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$better$2d$auth$40$1$2e$4$2e$7_$40$prisma$2b$client$40$7$2e$1$2e$0_prisma$40$7$2e$1$2e$0_$40$types$2b$react$40$19$2e$2$2e$7_react$2d$dom$40$19$2e$2$2e$_bd7c77fb510da8d9502659b8eb9a6693$2f$node_modules$2f$better$2d$auth$2f$dist$2f$integrations$2f$next$2d$js$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["nextCookies"])()
    ]
});
}),
"[project]/lib/db.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "closeDatabase",
    ()=>closeDatabase,
    "getDatabase",
    ()=>getDatabase
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongodb [external] (mongodb, cjs)");
;
const connectionString = process.env.DATABASE_URL || "mongodb://localhost:27017/trackify-ventures";
// Extract database name from connection string
function getDatabaseName(connectionString) {
    try {
        const url = new URL(connectionString.replace(/^mongodb\+srv:/, "mongodb:"));
        const pathname = url.pathname;
        // Remove leading slash and get database name
        const dbName = pathname.split("/")[1]?.split("?")[0] || "trackify-ventures";
        return dbName;
    } catch  {
        // Fallback: try to extract from connection string manually
        const match = connectionString.match(/\/([^/?]+)(\?|$)/);
        return match ? match[1] : "trackify-ventures";
    }
}
const databaseName = getDatabaseName(connectionString);
// Create MongoDB client with proper connection options for Atlas
const client = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__["MongoClient"](connectionString, {
    maxPoolSize: 10,
    minPoolSize: 2,
    maxIdleTimeMS: 30000,
    serverSelectionTimeoutMS: 10000,
    socketTimeoutMS: 45000,
    connectTimeoutMS: 10000,
    retryWrites: true,
    retryReads: true
});
// Global client instance to reuse across requests (Next.js pattern)
const globalForMongo = globalThis;
let clientPromise;
if ("TURBOPACK compile-time truthy", 1) {
    // In development, use a global variable so the client is not recreated on hot reloads
    if (!globalForMongo._mongoClientPromise) {
        globalForMongo._mongoClientPromise = client.connect().catch((error)=>{
            console.error("Failed to connect to MongoDB:", error);
            return client;
        });
    }
    clientPromise = globalForMongo._mongoClientPromise;
} else //TURBOPACK unreachable
;
// Initialize connection immediately (non-blocking)
clientPromise.then((connectedClient)=>{
    globalForMongo._mongoClient = connectedClient;
    console.log("MongoDB connected successfully (db.ts)");
}).catch((error)=>{
    console.error("MongoDB connection error (db.ts):", error);
});
async function getDatabase() {
    try {
        // Ensure client is connected
        const connectedClient = await clientPromise;
        // Check if client is still connected, reconnect if needed
        if (!connectedClient.topology?.isConnected()) {
            console.warn("MongoDB client disconnected, reconnecting...");
            await connectedClient.connect();
        }
        return connectedClient.db(databaseName);
    } catch (error) {
        console.error("Error getting database connection:", error);
        // Try to reconnect
        try {
            await client.close();
            const newClient = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__["MongoClient"](connectionString, {
                maxPoolSize: 10,
                minPoolSize: 2,
                maxIdleTimeMS: 30000,
                serverSelectionTimeoutMS: 10000,
                socketTimeoutMS: 45000,
                connectTimeoutMS: 10000,
                retryWrites: true,
                retryReads: true
            });
            clientPromise = newClient.connect();
            const connectedClient = await clientPromise;
            return connectedClient.db(databaseName);
        } catch (reconnectError) {
            console.error("Failed to reconnect to MongoDB:", reconnectError);
            throw reconnectError;
        }
    }
}
async function closeDatabase() {
    try {
        const connectedClient = await clientPromise;
        await connectedClient.close();
    } catch (error) {
        console.error("Error closing database connection:", error);
    }
}
}),
"[project]/lib/auth-helpers.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getSessionWithRole",
    ()=>getSessionWithRole,
    "requireAuth",
    ()=>requireAuth,
    "requireOnboarding",
    ()=>requireOnboarding
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/auth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.10_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
;
;
;
async function getSessionWithRole() {
    try {
        const session = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["auth"].api.getSession({
            headers: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["headers"])()
        });
        if (!session) {
            return null;
        }
        // Get user with role from database
        const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDatabase"])();
        // Log database info for debugging
        const dbName = db.databaseName;
        console.log("Querying database:", dbName, "for user ID:", session.user.id, "Email:", session.user.email);
        // Better Auth with MongoDB uses _id as primary key, not id
        // The session.user.id is the string representation of _id
        let user = null;
        let queryMethod = "unknown";
        // Try _id first (MongoDB's primary key) - this is what Better Auth uses
        try {
            const { ObjectId } = await __turbopack_context__.A("[externals]/mongodb [external] (mongodb, cjs, async loader)");
            if (ObjectId.isValid(session.user.id)) {
                user = await db.collection("user").findOne({
                    _id: new ObjectId(session.user.id)
                });
                if (user) {
                    queryMethod = "_id";
                    console.log("Found user by _id!");
                }
            }
        } catch (e) {
            console.log("ObjectId query failed:", e);
        }
        // If not found by _id, try by email as fallback
        if (!user && session.user.email) {
            console.log("User not found by _id, trying email:", session.user.email);
            user = await db.collection("user").findOne({
                email: session.user.email
            });
            if (user) {
                queryMethod = "email";
                console.log("Found user by email!");
            } else {
                console.log("User not found by email either");
            }
        }
        // Last resort: try id field (though Better Auth doesn't use this)
        if (!user) {
            user = await db.collection("user").findOne({
                id: session.user.id
            });
            if (user) {
                queryMethod = "id";
                console.log("Found user by id field");
            }
        }
        // List all users for debugging (remove in production)
        if (!user) {
            const allUsers = await db.collection("user").find({}).limit(5).toArray();
            console.log("Sample users in database:", allUsers.map((u)=>({
                    id: u.id,
                    _id: u._id?.toString(),
                    email: u.email,
                    role: u.role,
                    onboardingCompleted: u.onboardingCompleted
                })));
        }
        if (!user) {
            console.warn("User not found in database for session:", {
                userId: session.user.id,
                email: session.user.email,
                database: dbName
            });
            // Return session without role if user not found in database yet
            // This can happen during signup before user is fully created
            return {
                ...session,
                user: {
                    ...session.user,
                    role: null,
                    onboardingCompleted: false
                }
            };
        }
        console.log("User found via", queryMethod, ":", {
            id: user.id,
            _id: user._id?.toString(),
            email: user.email,
            role: user.role,
            onboardingCompleted: user.onboardingCompleted
        });
        const result = {
            ...session,
            user: {
                ...session.user,
                role: user.role || null,
                onboardingCompleted: user.onboardingCompleted || false
            }
        };
        console.log("Returning session with role:", {
            userId: result.user.id,
            email: result.user.email,
            role: result.user.role,
            onboardingCompleted: result.user.onboardingCompleted
        });
        return result;
    } catch (error) {
        console.error("Error in getSessionWithRole:", error);
        // Return null on error to trigger redirect to sign-in
        return null;
    }
}
async function requireAuth() {
    const session = await getSessionWithRole();
    if (!session) {
        throw new Error("Unauthorized");
    }
    return session;
}
async function requireOnboarding() {
    const session = await requireAuth();
    if (!session.user.onboardingCompleted) {
        throw new Error("Onboarding not completed");
    }
    return session;
}
}),
"[project]/app/api/dashboard/stats/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.10_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$helpers$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/auth-helpers.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
;
;
;
async function GET(request) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$helpers$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionWithRole"])();
        if (!session) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Unauthorized"
            }, {
                status: 401
            });
        }
        const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDatabase"])();
        // Get all portfolio companies
        const companies = await db.collection("portfolio_companies").find({}).sort({
            createdAt: -1
        }).toArray();
        // Calculate metrics
        const totalPortfolioValue = companies.reduce((sum, company)=>{
            return sum + (company.amount || 0);
        }, 0);
        const activeInvestments = companies.length;
        // Calculate portfolio value over time (last 6 months)
        // Group companies by month of creation
        const now = new Date();
        const sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 6, 1);
        const portfolioValueOverTime = [];
        const monthNames = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec"
        ];
        for(let i = 5; i >= 0; i--){
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const monthEnd = new Date(now.getFullYear(), now.getMonth() - i + 1, 0);
            // Calculate cumulative value up to this month
            const companiesUpToMonth = companies.filter((company)=>{
                const companyDate = company.createdAt ? new Date(company.createdAt) : new Date();
                return companyDate <= monthEnd;
            });
            const value = companiesUpToMonth.reduce((sum, company)=>{
                return sum + (company.amount || 0);
            }, 0);
            portfolioValueOverTime.push({
                month: monthNames[date.getMonth()],
                value: value / 1000000
            });
        }
        // Get top performers (companies with highest investment amounts)
        const topPerformers = companies.filter((c)=>c.amount && c.amount > 0).sort((a, b)=>(b.amount || 0) - (a.amount || 0)).slice(0, 3).map((company, index)=>({
                id: company._id?.toString() || index.toString(),
                name: company.name,
                sector: company.industry || "Unknown",
                growth: "+" + (Math.random() * 30 + 10).toFixed(1) + "%",
                value: `$${((company.amount || 0) / 1000000).toFixed(1)}M`,
                trend: "up",
                amount: company.amount || 0
            }));
        // Calculate portfolio health score (simplified - can be enhanced)
        // Based on number of companies, diversity, etc.
        const portfolioHealth = Math.min(100, Math.max(60, 70 + activeInvestments * 2));
        // Get recent activity (from portfolio companies created/updated)
        const recentActivity = companies.slice(0, 3).map((company, index)=>{
            const createdAt = company.createdAt ? new Date(company.createdAt) : new Date();
            const hoursAgo = Math.floor((now.getTime() - createdAt.getTime()) / (1000 * 60 * 60));
            let timeAgo = "";
            if (hoursAgo < 1) {
                timeAgo = "Just now";
            } else if (hoursAgo < 24) {
                timeAgo = `${hoursAgo} hour${hoursAgo > 1 ? "s" : ""} ago`;
            } else {
                const daysAgo = Math.floor(hoursAgo / 24);
                timeAgo = `${daysAgo} day${daysAgo > 1 ? "s" : ""} ago`;
            }
            return {
                id: company._id?.toString() || index.toString(),
                type: "investment",
                message: `New investment in ${company.name}`,
                time: timeAgo,
                icon: "DollarSign"
            };
        });
        // Calculate growth percentage (simplified - compare current month to previous)
        const currentMonthValue = portfolioValueOverTime[portfolioValueOverTime.length - 1]?.value || 0;
        const previousMonthValue = portfolioValueOverTime[portfolioValueOverTime.length - 2]?.value || currentMonthValue;
        const growthPercentage = previousMonthValue > 0 ? ((currentMonthValue - previousMonthValue) / previousMonthValue * 100).toFixed(1) : "0";
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            data: {
                kpis: {
                    portfolioValue: {
                        value: `$${(totalPortfolioValue / 1000000).toFixed(1)}M`,
                        change: `+${growthPercentage}%`,
                        trend: parseFloat(growthPercentage) >= 0 ? "up" : "down"
                    },
                    activeInvestments: {
                        value: activeInvestments.toString(),
                        change: `+${companies.filter((c)=>{
                            const created = c.createdAt ? new Date(c.createdAt) : new Date();
                            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                            return created >= thisMonth;
                        }).length} this month`,
                        trend: "up"
                    },
                    portfolioHealth: {
                        value: `${portfolioHealth}/100`,
                        change: "+5 points",
                        trend: "up"
                    }
                },
                portfolioValueOverTime,
                topPerformers,
                recentActivity
            }
        });
    } catch (error) {
        console.error("Error fetching dashboard stats:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$10_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Failed to fetch dashboard stats"
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__81b83ddc._.js.map
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\"\nimport { MongoClient } from \"mongodb\"\nimport { mongodbAdapter } from \"better-auth/adapters/mongodb\"\nimport { nextCookies } from \"better-auth/next-js\"\n\n// MongoDB connection\nconst connectionString = process.env.DATABASE_URL || \"mongodb://localhost:27017/trackify-ventures\"\n\n// Extract database name from connection string\nfunction getDatabaseName(connectionString: string): string {\n  try {\n    const url = new URL(connectionString.replace(/^mongodb\\+srv:/, \"mongodb:\"))\n    const pathname = url.pathname\n    // Remove leading slash and get database name\n    const dbName = pathname.split(\"/\")[1]?.split(\"?\")[0] || \"trackify-ventures\"\n    return dbName\n  } catch {\n    // Fallback: try to extract from connection string manually\n    const match = connectionString.match(/\\/([^/?]+)(\\?|$)/)\n    return match ? match[1] : \"trackify-ventures\"\n  }\n}\n\nconst databaseName = getDatabaseName(connectionString)\nconst client = new MongoClient(connectionString)\n\n// Connect to MongoDB (will be called once)\nif (!client.topology?.isConnected()) {\n  client.connect().catch(console.error)\n}\n\n// Explicitly specify the database name\nconst db = client.db(databaseName)\n\nexport const auth = betterAuth({\n  database: mongodbAdapter(db, {\n    client,\n  }),\n  emailAndPassword: {\n    enabled: true,\n    requireEmailVerification: false, // Set to true if you want email verification\n  },\n  user: {\n    additionalFields: {\n      role: {\n        type: \"string\",\n        required: false,\n        defaultValue: null,\n        input: false, // Don't allow user to set role during signup\n      },\n      onboardingCompleted: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false,\n        input: false,\n      },\n    },\n  },\n  plugins: [nextCookies()],\n})\n\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AAAA;AACA;;;;;AAEA,qBAAqB;AACrB,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAErD,+CAA+C;AAC/C,SAAS,gBAAgB,gBAAwB;IAC/C,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,iBAAiB,OAAO,CAAC,kBAAkB;QAC/D,MAAM,WAAW,IAAI,QAAQ;QAC7B,6CAA6C;QAC7C,MAAM,SAAS,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;QACxD,OAAO;IACT,EAAE,OAAM;QACN,2DAA2D;QAC3D,MAAM,QAAQ,iBAAiB,KAAK,CAAC;QACrC,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;IAC5B;AACF;AAEA,MAAM,eAAe,gBAAgB;AACrC,MAAM,SAAS,IAAI,sHAAW,CAAC;AAE/B,2CAA2C;AAC3C,IAAI,CAAC,OAAO,QAAQ,EAAE,eAAe;IACnC,OAAO,OAAO,GAAG,KAAK,CAAC,QAAQ,KAAK;AACtC;AAEA,uCAAuC;AACvC,MAAM,KAAK,OAAO,EAAE,CAAC;AAEd,MAAM,OAAO,IAAA,4XAAU,EAAC;IAC7B,UAAU,IAAA,waAAc,EAAC,IAAI;QAC3B;IACF;IACA,kBAAkB;QAChB,SAAS;QACT,0BAA0B;IAC5B;IACA,MAAM;QACJ,kBAAkB;YAChB,MAAM;gBACJ,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;YACA,qBAAqB;gBACnB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;QACF;IACF;IACA,SAAS;QAAC,IAAA,2YAAW;KAAG;AAC1B"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/lib/db.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\"\n\nconst connectionString = process.env.DATABASE_URL || \"mongodb://localhost:27017/trackify-ventures\"\n\n// Extract database name from connection string\nfunction getDatabaseName(connectionString: string): string {\n  try {\n    const url = new URL(connectionString.replace(/^mongodb\\+srv:/, \"mongodb:\"))\n    const pathname = url.pathname\n    // Remove leading slash and get database name\n    const dbName = pathname.split(\"/\")[1]?.split(\"?\")[0] || \"trackify-ventures\"\n    return dbName\n  } catch {\n    // Fallback: try to extract from connection string manually\n    const match = connectionString.match(/\\/([^/?]+)(\\?|$)/)\n    return match ? match[1] : \"trackify-ventures\"\n  }\n}\n\nconst databaseName = getDatabaseName(connectionString)\n\nlet client: MongoClient | null = null\nlet db: Db | null = null\n\nexport async function getDatabase(): Promise<Db> {\n  if (db) {\n    return db\n  }\n\n  if (!client) {\n    client = new MongoClient(connectionString)\n    await client.connect()\n  }\n\n  // Explicitly specify the database name\n  db = client.db(databaseName)\n  return db\n}\n\n// For cleanup if needed\nexport async function closeDatabase() {\n  if (client) {\n    await client.close()\n    client = null\n    db = null\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAErD,+CAA+C;AAC/C,SAAS,gBAAgB,gBAAwB;IAC/C,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,iBAAiB,OAAO,CAAC,kBAAkB;QAC/D,MAAM,WAAW,IAAI,QAAQ;QAC7B,6CAA6C;QAC7C,MAAM,SAAS,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;QACxD,OAAO;IACT,EAAE,OAAM;QACN,2DAA2D;QAC3D,MAAM,QAAQ,iBAAiB,KAAK,CAAC;QACrC,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;IAC5B;AACF;AAEA,MAAM,eAAe,gBAAgB;AAErC,IAAI,SAA6B;AACjC,IAAI,KAAgB;AAEb,eAAe;IACpB,IAAI,IAAI;QACN,OAAO;IACT;IAEA,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,uCAAuC;IACvC,KAAK,OAAO,EAAE,CAAC;IACf,OAAO;AACT;AAGO,eAAe;IACpB,IAAI,QAAQ;QACV,MAAM,OAAO,KAAK;QAClB,SAAS;QACT,KAAK;IACP;AACF"}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///Users/ekaygabriel/Downloads/trackify-ventures-ui/app/api/user/update-role/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { auth } from \"@/lib/auth\"\nimport { headers } from \"next/headers\"\nimport { getDatabase } from \"@/lib/db\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth.api.getSession({\n      headers: await headers(),\n    })\n\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { role } = body\n\n    if (!role || (role !== \"investor\" && role !== \"founder\")) {\n      return NextResponse.json({ error: \"Invalid role\" }, { status: 400 })\n    }\n\n    // Get database connection\n    const db = await getDatabase()\n\n    // Try to find the user first to verify they exist\n    const userBefore = await db.collection(\"user\").findOne({ id: session.user.id })\n    \n    if (!userBefore) {\n      console.error(\"User not found in database. User ID:\", session.user.id)\n      console.error(\"Session user:\", session.user)\n      \n      // Try alternative query by email as fallback\n      const userByEmail = await db.collection(\"user\").findOne({ email: session.user.email })\n      if (userByEmail) {\n        console.log(\"Found user by email, updating with email query\")\n        const result = await db.collection(\"user\").updateOne(\n          { email: session.user.email },\n          {\n            $set: {\n              role,\n              onboardingCompleted: true,\n              updatedAt: new Date(),\n            },\n          }\n        )\n        return NextResponse.json({ \n          success: true, \n          role,\n          matchedCount: result.matchedCount,\n          modifiedCount: result.modifiedCount\n        })\n      }\n      \n      return NextResponse.json(\n        { error: \"User not found in database\" },\n        { status: 404 }\n      )\n    }\n\n    // Update user role and mark onboarding as completed\n    const result = await db.collection(\"user\").updateOne(\n      { id: session.user.id },\n      {\n        $set: {\n          role,\n          onboardingCompleted: true,\n          updatedAt: new Date(),\n        },\n      }\n    )\n\n    // Verify the update was successful\n    if (result.matchedCount === 0) {\n      console.error(\"User not found in database:\", session.user.id)\n      return NextResponse.json(\n        { error: \"User not found\" },\n        { status: 404 }\n      )\n    }\n\n    // Verify the update was actually saved by reading it back\n    const updatedUser = await db.collection(\"user\").findOne({ id: session.user.id })\n    \n    if (!updatedUser || updatedUser.role !== role || !updatedUser.onboardingCompleted) {\n      console.error(\"Update verification failed:\", {\n        userId: session.user.id,\n        expectedRole: role,\n        actualRole: updatedUser?.role,\n        expectedOnboarding: true,\n        actualOnboarding: updatedUser?.onboardingCompleted\n      })\n      return NextResponse.json(\n        { error: \"Update verification failed\" },\n        { status: 500 }\n      )\n    }\n\n    console.log(\"User update result:\", {\n      userId: session.user.id,\n      role,\n      matchedCount: result.matchedCount,\n      modifiedCount: result.modifiedCount,\n      verified: true\n    })\n\n    return NextResponse.json({ \n      success: true, \n      role,\n      onboardingCompleted: true,\n      matchedCount: result.matchedCount,\n      modifiedCount: result.modifiedCount\n    })\n  } catch (error) {\n    console.error(\"Error updating user role:\", error)\n    return NextResponse.json(\n      { error: \"Failed to update role\" },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}